<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP To-Do List</title>
    <!-- Tailwind CSS for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a clean look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* Custom font */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* Style for completed tasks */
        .completed {
            text-decoration: line-through;
            color: #888;
        }
        /* Custom animation for list items */
        .task-item {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto max-w-2xl mt-10 md:mt-20 px-4">
        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8">
            
            <!-- Header -->
            <div class="flex items-center mb-6">
                <svg class="h-8 w-8 text-blue-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h1 class="text-2xl md:text-3xl font-bold text-gray-800">My To-Do List</h1>
            </div>
            <!-- Add Task Form -->
            <form id="addTaskForm" class="flex flex-col sm:flex-row gap-3 mb-6">
                <input type="text" id="taskInput" placeholder="What do you need to do?" class="flex-grow w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200" required>
                <button type="submit" class="bg-blue-500 text-white font-semibold px-6 py-3 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-200 shadow hover:shadow-md">
                    Add Task
                </button>
            </form>
            <!-- Task List -->
            <div id="taskListContainer">
                <ul id="taskList" class="space-y-3">
                    <!-- Tasks will be dynamically inserted here -->
                </ul>
                <p id="loadingMessage" class="text-gray-500 text-center py-4">Loading tasks...</p>
                 <p id="emptyMessage" class="hidden text-gray-500 text-center py-4">Your to-do list is empty. Add a task to get started!</p>
            </div>
             <!-- Error Message Box -->
            <div id="errorMessage" class="hidden mt-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                <p><strong>Error:</strong> <span id="errorText"></span></p>
            </div>
        </div>
        <footer class="text-center text-gray-500 mt-8 text-sm">
            <p>A Simple To-Do App powered by PHP & JavaScript</p>
        </footer>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_URL = 'api.php';
            const taskList = document.getElementById('taskList');
            const addTaskForm = document.getElementById('addTaskForm');
            const taskInput = document.getElementById('taskInput');
            const loadingMessage = document.getElementById('loadingMessage');
            const emptyMessage = document.getElementById('emptyMessage');
            const errorMessage = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            // --- API Communication ---
            /**
             * Fetches tasks from the backend and renders them.
             */
            const fetchTasks = async () => {
                showLoading(true);
                try {
                    const response = await fetch(API_URL);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const tasks = await response.json();
                    renderTasks(tasks);
                } catch (error) {
                    showError(`Failed to fetch tasks: ${error.message}`);
                    renderTasks([]); // Render an empty list on error
                } finally {
                    showLoading(false);
                }
            };
            /**
             * Sends a new task to the backend.
             * @param {string} taskText The content of the task.
             */
            const addTask = async (taskText) => {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'add', task: taskText })
                    });
                    if (!response.ok) {
                        throw new Error('Failed to add task.');
                    }
                    await response.json(); // Wait for confirmation
                    taskInput.value = ''; // Clear input field
                    await fetchTasks(); // Refresh the list
                } catch (error) {
                    showError(error.message);
                }
            };
            /**
             * Toggles the completion status of a task.
             * @param {number} id The ID of the task.
             * @param {boolean} isCompleted The new completion status.
             */
            const toggleTaskComplete = async (id, isCompleted) => {
                 try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'update', id, is_completed: isCompleted })
                    });
                     if (!response.ok) {
                        throw new Error('Failed to update task.');
                    }
                    await response.json();
                    await fetchTasks();
                 } catch (error) {
                     showError(error.message);
                 }
            };
            /**
             * Deletes a task from the backend.
             * @param {number} id The ID of the task to delete.
             */
            const deleteTask = async (id) => {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action: 'delete', id })
                    });
                    if (!response.ok) {
                       throw new Error('Failed to delete task.');
                    }
                    await response.json();
                    await fetchTasks(); // Refresh list
                } catch (error) {
                    showError(error.message);
                }
            };
            // --- UI Rendering and Helpers ---
            /**
             * Renders the list of tasks to the DOM.
             * @param {Array} tasks An array of task objects.
             */
            const renderTasks = (tasks) => {
                taskList.innerHTML = ''; // Clear existing list
                if (tasks.length === 0) {
                    emptyMessage.classList.remove('hidden');
                } else {
                    emptyMessage.classList.add('hidden');
                    tasks.forEach(task => {
                        const li = document.createElement('li');
                        li.className = 'task-item flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200 transition duration-200 hover:shadow-sm hover:border-gray-300';
                        li.dataset.id = task.id;
                        // Checkbox and Text container
                        const taskContent = document.createElement('div');
                        taskContent.className = 'flex items-center flex-grow';
                        const checkbox = document.createElement('input');
                        checkbox.type = 'checkbox';
                        checkbox.checked = task.is_completed;
                        checkbox.className = 'h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 mr-4 cursor-pointer';
                        const text = document.createElement('span');
                        text.textContent = task.task;
                        text.className = `flex-grow ${task.is_completed ? 'completed' : ''}`;
                        taskContent.appendChild(checkbox);
                        taskContent.appendChild(text);
                        // Delete button
                        const deleteBtn = document.createElement('button');
                        deleteBtn.innerHTML = `
                            <svg class="w-5 h-5 text-gray-400 hover:text-red-500 transition-colors" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.134-2.033-2.134H8.033C6.91 2.75 6 3.664 6 4.834v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                            </svg>
                        `;
                        deleteBtn.className = 'delete-btn p-1';

                        li.appendChild(taskContent);
                        li.appendChild(deleteBtn);
                        taskList.appendChild(li);
                    });
                }
            };
            /**
             * Shows or hides the loading indicator.
             * @param {boolean} isLoading True to show, false to hide.
             */
            const showLoading = (isLoading) => {
                loadingMessage.style.display = isLoading ? 'block' : 'none';
                if (isLoading) {
                    taskList.innerHTML = '';
                    emptyMessage.classList.add('hidden');
                }
            };
            /**
             * Displays an error message to the user.
             * @param {string} message The error message to display.
             */
            const showError = (message) => {
                errorText.textContent = message;
                errorMessage.classList.remove('hidden');
                // Hide the error message after 5 seconds
                setTimeout(() => {
                    errorMessage.classList.add('hidden');
                }, 5000);
            };
            // --- Event Listeners ---
            // Handle form submission to add a new task
            addTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const taskText = taskInput.value.trim();
                if (taskText) {
                    addTask(taskText);
                }
            });
            // Handle clicks on the task list (for delete and complete)
            taskList.addEventListener('click', (e) => {
                const target = e.target;
                const li = target.closest('li');
                if (!li) return;

                const id = li.dataset.id;

                // Handle task deletion
                if (target.closest('.delete-btn')) {
                    if (confirm('Are you sure you want to delete this task?')) {
                        deleteTask(id);
                    }
                }
                // Handle task completion toggle
                else if (target.type === 'checkbox') {
                    toggleTaskComplete(id, target.checked);
                }
            });
            // Initial fetch of tasks when the page loads
            fetchTasks();
        });
    </script>
</body>
</html>

